<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant World - FloraLab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap');
        
        :root {
            --bg-primary: #f8fafc;
            --card-bg: rgba(255, 255, 255, 0.98);
            --text-primary: #0f172a;
            --border-color: rgba(0, 0, 0, 0.08);
        }

        .dark {
            --bg-primary: #020617;
            --card-bg: rgba(15, 23, 42, 0.95);
            --text-primary: #f1f5f9;
            --border-color: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease;
        }

        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
        }

        .plant-float {
            animation: float 5s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-15px) scale(1.03); }
        }

        .tab-active {
            border-bottom: 3px solid #16a34a;
            color: #16a34a;
        }

        /* Immersion Backgrounds */
        .bg-desert { background: linear-gradient(#fde68a, #f59e0b) !important; }
        .bg-forest { background: linear-gradient(#059669, #064e3b) !important; }
        .bg-space { background: #0f172a radial-gradient(white 1px, transparent 0px) !important; background-size: 30px 30px !important; }
        .bg-zen { background: linear-gradient(#e2e8f0, #94a3b8) !important; }
        .bg-sunset { background: linear-gradient(#fb7185, #f43f5e, #9f1239) !important; }

        .bg-item-emoji {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18rem;
            opacity: 0.25;
            z-index: 0;
            pointer-events: none;
            filter: blur(2px);
        }

        .accessory-hat { position: absolute; top: -35px; left: 50%; transform: translateX(-50%); font-size: 3.8rem; z-index: 20; }
        
        .owned-badge {
            font-size: 0.6rem;
            background: #dcfce7;
            color: #166534;
            padding: 2px 8px;
            border-radius: 99px;
            position: absolute;
            top: 8px;
            right: 8px;
            font-weight: 800;
        }

        .equipped-ring {
            border: 3px solid #16a34a !important;
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(22, 163, 74, 0.2);
        }

        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #64748b; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen">

    <nav class="glass-card sticky top-0 z-50 px-6 py-4 border-b">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-3xl">üåø</span>
                <h1 class="font-black text-xl tracking-tight uppercase">FloraLab</h1>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="toggleTheme()" class="p-2.5 rounded-2xl bg-slate-100 dark:bg-slate-800 transition-colors">
                    <span id="theme-icon">üåô</span>
                </button>
                <div class="px-5 py-2.5 rounded-2xl bg-green-600 text-white font-black shadow-xl shadow-green-600/20 flex items-center gap-2">
                    <span id="total-score">0</span>
                    <span class="text-[10px] opacity-70">GP</span>
                </div>
                <button onclick="resetGame()" class="text-[10px] opacity-30 hover:opacity-100 font-bold uppercase transition-opacity">Reset All</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-6">
        
        <div class="flex gap-10 mb-8 border-b border-slate-200 dark:border-slate-800">
            <button onclick="switchTab('care')" id="tab-care" class="pb-4 font-black text-sm tracking-widest transition-all tab-active">MY GARDEN</button>
            <button onclick="switchTab('quiz')" id="tab-quiz" class="pb-4 font-black text-sm tracking-widest transition-all text-slate-400">CHALLENGES</button>
            <button onclick="switchTab('discovery')" id="tab-discovery" class="pb-4 font-black text-sm tracking-widest transition-all text-slate-400">DISCOVERY</button>
        </div>

        <!-- Care Section -->
        <section id="section-care" class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-5">
                <div id="plant-display-area" class="rounded-[3rem] p-12 text-center relative overflow-hidden h-[540px] flex flex-col justify-center items-center shadow-2xl transition-all duration-700">
                    <div id="bg-emoji-overlay" class="bg-item-emoji"></div>
                    
                    <div class="relative z-10">
                        <span id="equipped-hat" class="accessory-hat"></span>
                        <div id="plant-stage" class="text-[11rem] plant-float drop-shadow-2xl">üå±</div>
                    </div>

                    <div class="mt-auto w-full z-10 bg-black/30 backdrop-blur-xl p-6 rounded-[2rem] border border-white/20">
                        <div class="flex justify-between text-[11px] font-black uppercase tracking-widest text-white mb-2">
                            <span id="growth-label">Seedling</span>
                            <span id="growth-val">0%</span>
                        </div>
                        <div class="w-full h-3 bg-white/20 rounded-full overflow-hidden">
                            <div id="growth-bar" class="h-full bg-white transition-all duration-1000 w-0"></div>
                        </div>
                        <div class="mt-6 flex justify-center gap-4">
                            <button onclick="careAction('water')" class="w-16 h-16 bg-white/20 hover:bg-white/40 rounded-2xl flex items-center justify-center text-3xl transition-all hover:scale-110">üíß</button>
                            <button onclick="careAction('sun')" class="w-16 h-16 bg-white/20 hover:bg-white/40 rounded-2xl flex items-center justify-center text-3xl transition-all hover:scale-110">‚òÄÔ∏è</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-7">
                <div class="glass-card rounded-[3rem] p-8 h-[540px] flex flex-col">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-2xl font-black italic uppercase">Boutique</h2>
                    </div>
                    <div id="shop-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-4 overflow-y-auto pr-2 custom-scroll flex-1"></div>
                </div>
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="section-quiz" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></section>

        <!-- Discovery Section -->
        <section id="section-discovery" class="hidden space-y-8">
            <div class="glass-card p-12 rounded-[3rem] border-2 border-green-500/20 text-center">
                <h2 class="text-3xl font-black mb-2">Google Plant Discovery</h2>
                <p class="text-sm opacity-50 mb-10">Search the global botanical knowledge base</p>
                <div class="flex gap-4 max-w-2xl mx-auto">
                    <input type="text" id="api-input" placeholder="Type a plant name (e.g. Rose, Oak, Cactus)..." class="flex-1 bg-slate-100 dark:bg-slate-800/50 p-6 rounded-[2rem] outline-none focus:ring-4 ring-green-500/10 transition-all font-bold">
                    <button onclick="performSearch()" class="bg-green-600 text-white w-20 h-20 rounded-[2rem] flex items-center justify-center hover:bg-green-700 transition-all shadow-xl shadow-green-600/30">
                        <span id="search-icon" class="text-3xl">üîç</span>
                        <div id="search-loader" class="w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin hidden"></div>
                    </button>
                </div>
            </div>

            <div class="space-y-6">
                <div class="flex items-center justify-between px-4">
                    <h3 class="font-black text-lg uppercase tracking-widest opacity-40">Search Results</h3>
                    <span id="results-count" class="text-[10px] font-bold bg-slate-100 dark:bg-slate-800 px-3 py-1 rounded-full">0 FOUND</span>
                </div>
                <div id="api-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            </div>
        </section>
    </main>

    <script>
        const apiKey = ""; // API key managed by environment
        const PERSIST_KEY = "FloraLab_User_Data_Final";

        // --- State Management ---
        let state = {
            gp: 0,
            owned: [],
            equipped: { hat: null, bg: null },
            growth: 0,
            theme: 'light'
        };

        const load = () => {
            const saved = localStorage.getItem(PERSIST_KEY);
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state = { ...state, ...parsed };
                } catch (e) { console.error("Load failed", e); }
            }
            updateUI();
        };

        const save = () => {
            localStorage.setItem(PERSIST_KEY, JSON.stringify(state));
            updateUI();
        };

        const shopItems = [
            { id: 'b1', type: 'bg', val: 'bg-desert', emoji: 'üèúÔ∏è', label: 'Dunes', cost: 100 },
            { id: 'b2', type: 'bg', val: 'bg-forest', emoji: 'üå≤', label: 'Wildwood', cost: 250 },
            { id: 'b3', type: 'bg', val: 'bg-space', emoji: 'üåå', label: 'Starlight', cost: 1000 },
            { id: 'b4', type: 'bg', val: 'bg-zen', emoji: 'üéã', label: 'Quiet Garden', cost: 400 },
            { id: 'b5', type: 'bg', val: 'bg-sunset', emoji: 'üåá', label: 'Red Peaks', cost: 600 },
            { id: 'h1', type: 'hat', val: 'üé©', emoji: 'üé©', label: 'Formal Wear', cost: 150 },
            { id: 'h2', type: 'hat', val: 'üëë', emoji: 'üëë', label: 'Flora Heir', cost: 500 },
            { id: 'h3', type: 'hat', val: 'üëí', emoji: 'üëí', label: 'Sun Hat', cost: 80 }
        ];

        function updateUI() {
            document.getElementById('total-score').innerText = state.gp;
            document.getElementById('growth-val').innerText = state.growth + "%";
            document.getElementById('growth-bar').style.width = Math.min(100, state.growth) + "%";
            
            document.documentElement.classList.toggle('dark', state.theme === 'dark');
            document.getElementById('theme-icon').innerText = state.theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

            const hat = shopItems.find(i => i.id === state.equipped.hat);
            const bg = shopItems.find(i => i.id === state.equipped.bg);

            document.getElementById('equipped-hat').innerText = hat ? hat.val : '';
            
            const stage = document.getElementById('plant-stage');
            const label = document.getElementById('growth-label');
            if(state.growth >= 100) { stage.innerText = 'üå≥'; label.innerText = 'Ancient Oak'; }
            else if(state.growth >= 60) { stage.innerText = 'ü™¥'; label.innerText = 'Blooming Shrub'; }
            else if(state.growth >= 30) { stage.innerText = 'üåø'; label.innerText = 'Young Fern'; }
            else { stage.innerText = 'üå±'; label.innerText = 'Fresh Seedling'; }

            const display = document.getElementById('plant-display-area');
            const overlay = document.getElementById('bg-emoji-overlay');
            
            display.className = `rounded-[3rem] p-12 text-center relative overflow-hidden h-[540px] flex flex-col justify-center items-center shadow-2xl transition-all duration-700 ${bg ? bg.val : 'bg-slate-100 dark:bg-slate-900'}`;
            overlay.innerText = bg ? bg.emoji : '';

            renderShop();
        }

        function renderShop() {
            const grid = document.getElementById('shop-grid');
            grid.innerHTML = '';
            shopItems.forEach(item => {
                const owned = state.owned.includes(item.id);
                const active = state.equipped[item.type === 'bg' ? 'bg' : 'hat'] === item.id;
                
                const card = document.createElement('div');
                card.className = `relative p-5 rounded-[2rem] border-2 transition-all cursor-pointer flex flex-col items-center text-center ${active ? 'equipped-ring bg-white dark:bg-white/5 shadow-xl' : 'bg-white/50 dark:bg-white/5 border-transparent hover:border-slate-300'}`;
                card.onclick = () => {
                    if(!owned) {
                        if(state.gp < item.cost) return alertMsg(`Need ${item.cost - state.gp} more GP!`);
                        state.gp -= item.cost;
                        state.owned.push(item.id);
                    } else {
                        if(item.type === 'bg') state.equipped.bg = active ? null : item.id;
                        else if(item.type === 'hat') state.equipped.hat = active ? null : item.id;
                    }
                    save();
                };
                card.innerHTML = `
                    ${owned ? '<span class="owned-badge">OWNED</span>' : ''}
                    <div class="text-4xl mb-2">${item.emoji}</div>
                    <div class="text-[10px] font-black uppercase opacity-60 mb-2">${item.label}</div>
                    <div class="text-[10px] font-black ${owned ? 'text-green-600' : 'text-orange-500'}">${owned ? (active ? 'UNEQUIP' : 'EQUIP') : item.cost + ' GP'}</div>
                `;
                grid.appendChild(card);
            });
        }

        function careAction(type) {
            state.growth = Math.min(100, state.growth + 2);
            state.gp += 10;
            save();
            alertMsg(type === 'water' ? "Fresh Water! +10 GP" : "Solar Energy! +10 GP");
        }

        function toggleTheme() { state.theme = state.theme === 'light' ? 'dark' : 'light'; save(); }

        function switchTab(t) {
            ['care', 'quiz', 'discovery'].forEach(s => {
                document.getElementById(`section-${s}`).classList.add('hidden');
                document.getElementById(`tab-${s}`).classList.replace('tab-active', 'text-slate-400');
            });
            document.getElementById(`section-${t}`).classList.remove('hidden');
            document.getElementById(`tab-${t}`).classList.replace('text-slate-400', 'tab-active');
        }

        // --- Google Plant Search ---
        async function performSearch() {
            const query = document.getElementById('api-input').value.trim();
            if (!query) return;

            const loader = document.getElementById('search-loader');
            const icon = document.getElementById('search-icon');
            loader.classList.remove('hidden');
            icon.classList.add('hidden');

            const systemPrompt = "You are a botanical database. Return results for the requested plant in JSON format. For each result, include common_name, scientific_name, family, description, and an emoji icon representing the plant.";
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Search results for: ${query}` }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: { 
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "OBJECT",
                                properties: {
                                    results: {
                                        type: "ARRAY",
                                        items: {
                                            type: "OBJECT",
                                            properties: {
                                                common_name: { type: "STRING" },
                                                scientific_name: { type: "STRING" },
                                                family: { type: "STRING" },
                                                description: { type: "STRING" },
                                                emoji: { type: "STRING" }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    })
                });

                const data = await response.json();
                const parsed = JSON.parse(data.candidates[0].content.parts[0].text);
                
                renderResults(parsed.results);
                state.gp += 50;
                save();
            } catch (e) {
                console.error(e);
                alertMsg("Search failed. Try again.");
            } finally {
                loader.classList.add('hidden');
                icon.classList.remove('hidden');
            }
        }

        function renderResults(plants) {
            const grid = document.getElementById('api-results');
            document.getElementById('results-count').innerText = `${plants.length} FOUND`;
            grid.innerHTML = '';
            plants.forEach(p => {
                const card = document.createElement('div');
                card.className = "glass-card p-8 rounded-[2.5rem] hover:shadow-2xl transition-all border-2 border-transparent hover:border-green-500/30";
                card.innerHTML = `
                    <div class="text-6xl mb-6">${p.emoji || 'üåø'}</div>
                    <div class="text-[10px] font-black text-green-600 uppercase mb-2 tracking-widest">${p.family}</div>
                    <h3 class="font-black text-2xl mb-1">${p.common_name}</h3>
                    <p class="text-xs italic opacity-40 mb-4">${p.scientific_name}</p>
                    <p class="text-sm opacity-70 leading-relaxed">${p.description}</p>
                `;
                grid.appendChild(card);
            });
        }

        const quizzes = [
            { title: 'Photosynthesis', icon: '‚òÄÔ∏è', q: "What do plants exhale?", opt: ["CO2", "Oxygen", "Nitrogen"], c: 1 },
            { title: 'Root Systems', icon: 'ü•ï', q: "Which root goes deepest?", opt: ["Fibrous", "Taproot", "Aerial"], c: 1 },
            { title: 'Adaptation', icon: 'üåµ', q: "Desert plants are called?", opt: ["Hydrophytes", "Xerophytes", "Halophytes"], c: 1 }
        ];

        function initQuizzes() {
            const menu = document.getElementById('section-quiz');
            menu.innerHTML = '';
            quizzes.forEach(q => {
                const card = document.createElement('div');
                card.className = "glass-card p-8 rounded-[2.5rem] hover:border-green-500 transition-all cursor-pointer text-center";
                card.onclick = () => {
                    const ans = prompt(`${q.q}\n\n1. ${q.opt[0]}\n2. ${q.opt[1]}\n3. ${q.opt[2]}`);
                    if(parseInt(ans) === q.c + 1) {
                        state.gp += 100;
                        alertMsg("Correct! +100 GP");
                    } else { alertMsg("Incorrect"); }
                    save();
                };
                card.innerHTML = `<span class="text-5xl block mb-4">${q.icon}</span><h3 class="text-lg font-black uppercase tracking-tight">${q.title}</h3>`;
                menu.appendChild(card);
            });
        }

        function alertMsg(t) {
            const m = document.createElement('div');
            m.className = "fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-4 rounded-full font-black text-xs shadow-2xl z-[100] animate-bounce";
            m.innerText = t;
            document.body.appendChild(m);
            setTimeout(() => m.remove(), 2500);
        }

        function resetGame() { if(confirm("Clear all botanical history?")) { localStorage.removeItem(PERSIST_KEY); location.reload(); } }

        window.onload = load;
        initQuizzes();
    </script>
</body>
</html>